<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>memry</title>
    <link rel="icon" type="image/png" href="images/icon.png">
    <link rel="apple-touch-icon" href="images/icon.png">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Helvetica, sans-serif;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .large-button {
            border: none; /* Remove button border */
            background: none; /* Remove button background */
            font-weight: bold;
            font-size: 3vw;
            cursor: pointer; /* Add pointer cursor on hover */
        }

        #video-preview {
            width: 100%;
            height: auto;
            border-radius: 10px;
            object-fit: cover; /* Ensure the video fills the container without distortion */
        }

        #shutter-button {
            border: none; /* Remove button border */
            background: none; /* Remove button background */
            font-weight: bold;
            font-size: 1.5vw;
            cursor: pointer;
        }

        .small-button {
            background: none;
            border: none;
            font-weight: bold;
            font-size: 1.5vw;
            cursor: pointer;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background-color: black;
                color: white;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <div><button class="large-button" onclick="openCamera('memry')">make a memry</button></div>
    </div>

    <div id="camera-view" class="container" style="display: none;">
        <div><button class="small-button" onclick="goBack()">back</button></div>
        <div><video id="video-preview" autoplay></video></div>
        <div><button id="shutter-button">make memry</button></div>
    </div>

    <script>
        let videoStream = null;

        // Function to open the camera view
        function openCamera(purpose) {
            document.getElementById('container').style.display = 'none';
            document.getElementById('camera-view').style.display = 'block';
            initializeCamera();
            document.getElementById('shutter-button').onclick = function() {
                takePhoto(purpose);
            };
        }

        // Adjust video container size on window resize
        window.addEventListener('resize', function() {
            var videoContainer = document.getElementById('video-preview');
            var minDimension = Math.min(window.innerWidth, window.innerHeight);
            videoContainer.style.width = 0.9 * minDimension + 'px';
            videoContainer.style.height = 0.9 * minDimension + 'px';
        });

        // Set initial size
        window.dispatchEvent(new Event('resize'));

        // Function to initialize the camera
        async function initializeCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.getElementById('video-preview');
                videoStream = stream;
                video.srcObject = stream;
            } catch (err) {
                console.error('Error accessing camera:', err);
            }
        }

        // Function to take a photo
        function takePhoto(purpose) {
            const video = document.getElementById('video-preview');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoWidth; // Ensure canvas is square
            ctx.drawImage(video, (video.videoWidth - video.videoHeight) / 2, 0, video.videoHeight, video.videoHeight, 0, 0, canvas.width, canvas.height); // Crop to square

            // Stop video stream
            video.srcObject.getVideoTracks().forEach(track => track.stop());
            videoStream = null;

            // Prompt user for a description
            const description = prompt('Enter a description for the photo:');

            // Convert canvas to image
            const imgData = canvas.toDataURL('image/jpeg');

            // Generate filename with description
            const date = new Date();
            const fileName = `${date.getFullYear()}_${date.getMonth() + 1}_${date.getDate()} ${description}.jpg`;

            // Create a link to download the image
            const link = document.createElement('a');
            link.href = imgData;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Show the container and hide the camera view after taking the photo
            document.getElementById('container').style.display = 'flex';
            document.getElementById('camera-view').style.display = 'none';
        }

        // Function to go back to the container with buttons
        function goBack() {
            document.getElementById('container').style.display = 'flex';
            document.getElementById('camera-view').style.display = 'none';
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
        }
    </script>
</body>
</html>
